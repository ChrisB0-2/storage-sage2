package policy

import (
	"context"
	"time"

	"github.com/ChrisB0-2/storage-sage/internal/core"
)

type AgePolicy struct {
	MinAge time.Duration
}

func NewAgePolicy(minAgeDays int) *AgePolicy {
	return &AgePolicy{MinAge: time.Duration(minAgeDays) * 24 * time.Hour}
}

func (p *AgePolicy) Evaluate(_ context.Context, c core.Candidate, env core.EnvSnapshot) core.Decision {
	age := env.Now.Sub(c.ModTime)
	if age >= p.MinAge {
		return core.Decision{Allow: true, Reason: "age_ok"}
	}
	return core.Decision{Allow: false, Reason: "too_new"}
}
